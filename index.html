<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive Timetable Scheduler</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#60a5fa; --accent-2:#60e6a8; --text:#e6eef8;
      --slot-height:60px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071021 0%, #071226 100%);color:var(--text)}
    .app{max-width:1100px;margin:24px auto;padding:20px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:10px;align-items:center}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:var(--text);cursor:pointer}
    button.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;color:#05202b}
    .layout{display:grid;grid-template-columns:260px 1fr;gap:18px;margin-top:16px}
    .panel{background:rgba(255,255,255,0.02);padding:14px;border-radius:10px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
    .task-list{display:flex;flex-direction:column;gap:8px;max-height:420px;overflow:auto;margin-top:10px}
    .task-item{padding:8px;border-radius:8px;border:1px dashed rgba(255,255,255,0.04);cursor:grab}
    .task-item:active{cursor:grabbing}
    .timetable{overflow:auto;border-radius:8px;padding:12px}
    .grid{display:grid;grid-template-columns:80px 1fr;min-width:700px}
    .times{display:flex;flex-direction:column}
    .time-slot{height:var(--slot-height);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:13px;border-top:1px solid rgba(255,255,255,0.02)}
    .slots{background:linear-gradient(180deg, rgba(6,10,20,0.3), rgba(6,10,20,0.2));padding:6px;border-radius:8px}
    .slot{height:var(--slot-height);border-top:1px dashed rgba(255,255,255,0.03);position:relative}
    .slot.highlight{background:linear-gradient(90deg, rgba(96,165,250,0.06), rgba(96,230,168,0.03))}
    .placed{position:absolute;left:6px;right:6px;padding:6px;border-radius:8px;background:linear-gradient(90deg, rgba(96,165,250,0.16), rgba(96,230,168,0.08));border:1px solid rgba(96,165,250,0.12);color:#05202b}
    .placed .meta{font-size:12px;color:var(--text);opacity:0.9}
    .small{font-size:12px;color:var(--muted)}
    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
    .legend{display:flex;gap:8px;align-items:center}
    .pill{padding:6px 8px;border-radius:999px;border:1px solid rgba(255,255,255,0.04);font-size:12px}
    .help{font-size:13px;color:var(--muted)}
    @media (max-width:900px){.layout{grid-template-columns:1fr;}.grid{min-width:unset}}
  </style>
</head>
<body>
  <div class="app" role="application">
    <header>
      <div>
        <h1>Interactive Timetable Scheduler</h1>
        <div class="small">Add tasks, drag them onto time slots, save to your browser.</div>
      </div>
      <div class="controls">
        <button id="loadBtn">Load</button>
        <button id="exportBtn">Export JSON</button>
        <button id="importBtn">Import JSON</button>
        <button id="printBtn" class="primary">Print</button>
      </div>
    </header>

    <div class="layout">
      <aside class="panel">
        <div>
          <label for="taskName">Task name</label>
          <input id="taskName" placeholder="e.g., Deep work / Prayer" />
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <div style="flex:1">
            <label for="taskDur">Duration (minutes)</label>
            <input id="taskDur" type="number" value="60" />
          </div>
          <div style="width:120px">
            <label for="taskColor">Color tag</label>
            <select id="taskColor">
              <option value="blue">Blue</option>
              <option value="green">Green</option>
              <option value="amber">Amber</option>
              <option value="violet">Violet</option>
            </select>
          </div>
        </div>
        <div style="margin-top:10px">
          <label for="notes">Notes (optional)</label>
          <textarea id="notes" rows="3" placeholder="Short notes"></textarea>
        </div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="addTask">Add to task bank</button>
          <button id="clearBank">Clear bank</button>
        </div>

        <div style="margin-top:14px">
          <label>Task bank</label>
          <div class="task-list" id="taskBank" aria-live="polite"></div>
        </div>

        <div style="margin-top:12px">
          <label>Timetable range</label>
          <div style="display:flex;gap:8px">
            <input id="startTime" type="time" value="11:00" />
            <input id="endTime" type="time" value="01:00" />
          </div>
          <div class="small" style="margin-top:6px">If end time is earlier than start, it will treat as next day.</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="renderGrid">Render</button>
            <button id="resetGrid">Reset slots</button>
          </div>
        </div>

      </aside>

      <main class="panel">
        <div class="timetable">
          <div class="grid" id="gridRoot">
            <!-- left column times, right column slots -->
          </div>
        </div>
        <div class="footer">
          <div class="legend">
            <div class="pill">Drag task -> slot</div>
            <div class="pill">Drop to place, double-click to edit</div>
          </div>
          <div class="help">Saved to browser localStorage. Use Export/Import to share.</div>
        </div>
      </main>
    </div>
  </div>

  <input id="importFile" type="file" accept="application/json" style="display:none" />

  <script>
    // Simple interactive timetable scheduler
    // Features:
    // - create tasks in a task bank
    // - drag task items onto time slots
    // - tasks have duration and will occupy multiple slots if needed
    // - save/load from localStorage
    // - export/import JSON
    // - print view

    // Utility helpers
    const q = (s, el = document) => el.querySelector(s);
    const qa = (s, el = document) => Array.from(el.querySelectorAll(s));

    // State
    let tasks = []; // bank tasks
    let placed = []; // placed tasks on timetable
    const SLOT_MIN = 30; // each slot represents 30 minutes visually

    // DOM refs
    const taskBank = q('#taskBank');
    const addTaskBtn = q('#addTask');
    const clearBankBtn = q('#clearBank');
    const exportBtn = q('#exportBtn');
    const importBtn = q('#importBtn');
    const loadBtn = q('#loadBtn');
    const printBtn = q('#printBtn');
    const renderGridBtn = q('#renderGrid');
    const resetGridBtn = q('#resetGrid');
    const startTimeInput = q('#startTime');
    const endTimeInput = q('#endTime');
    const importFile = q('#importFile');
    const gridRoot = q('#gridRoot');

    // Colors map
    const colorMap = {
      blue: ['linear-gradient(90deg, rgba(96,165,250,0.16), rgba(96,165,250,0.04))','rgba(96,165,250,0.12)'],
      green: ['linear-gradient(90deg, rgba(96,230,168,0.14), rgba(96,230,168,0.03))','rgba(96,230,168,0.12)'],
      amber: ['linear-gradient(90deg, rgba(250,204,21,0.12), rgba(250,204,21,0.02))','rgba(250,204,21,0.12)'],
      violet: ['linear-gradient(90deg, rgba(168,85,247,0.12), rgba(168,85,247,0.03))','rgba(168,85,247,0.12)']
    }

    // Init
    function init(){
      loadState();
      bind();
      renderGrid();
      renderTaskBank();
      renderPlaced();
    }

    function bind(){
      addTaskBtn.addEventListener('click', onAddTask);
      clearBankBtn.addEventListener('click', ()=>{ if(confirm('Clear all tasks from bank?')){tasks=[];saveState();renderTaskBank();}});
      exportBtn.addEventListener('click', onExport);
      importBtn.addEventListener('click', ()=>importFile.click());
      importFile.addEventListener('change', onImportFile);
      loadBtn.addEventListener('click', ()=>{loadState(true);renderGrid();renderTaskBank();renderPlaced();alert('Loaded saved timetable from localStorage');});
      printBtn.addEventListener('click', ()=>window.print());
      renderGridBtn.addEventListener('click', ()=>{renderGrid(true);});
      resetGridBtn.addEventListener('click', ()=>{if(confirm('Remove all placed tasks?')){placed=[];saveState();renderPlaced();}});
    }

    function onAddTask(){
      const name = q('#taskName').value.trim();
      const dur = parseInt(q('#taskDur').value,10) || 30;
      const color = q('#taskColor').value;
      const notes = q('#notes').value.trim();
      if(!name) return alert('Please enter a task name');
      const t = {id: 't_'+Date.now(),name,duration:dur,color,notes};
      tasks.push(t);
      saveState();
      renderTaskBank();
      q('#taskName').value=''; q('#notes').value='';
    }

    function renderTaskBank(){
      taskBank.innerHTML='';
      if(tasks.length===0){taskBank.innerHTML='<div class="small">No tasks in bank. Add one above.</div>';return}
      tasks.forEach(t=>{
        const el = document.createElement('div');
        el.className='task-item';
        el.draggable=true;
        el.dataset.id=t.id;
        el.innerHTML = `<strong>${escapeHtml(t.name)}</strong><div class="small">${t.duration} min • ${escapeHtml(t.notes||'')}</div>`;
        el.addEventListener('dragstart', e=>{
          e.dataTransfer.setData('text/plain', JSON.stringify({type:'bank',taskId:t.id}));
          e.dataTransfer.effectAllowed='copy';
        });
        el.addEventListener('dblclick', ()=>{
          if(confirm('Remove this task from bank?')){tasks = tasks.filter(x=>x.id!==t.id);saveState();renderTaskBank();}
        });
        taskBank.appendChild(el);
      });
    }

    function renderGrid(force=false){
      // compute slots between start and end
      const start = parseTime(startTimeInput.value||'11:00');
      const end = parseTime(endTimeInput.value||'01:00');
      const timeline = buildTimeline(start,end);
      gridRoot.innerHTML='';
      const left = document.createElement('div'); left.className='times';
      timeline.forEach(slot=>{ const t = document.createElement('div'); t.className='time-slot'; t.textContent = slot.label; left.appendChild(t); });
      const right = document.createElement('div'); right.className='slots';
      timeline.forEach(slot=>{
        const s = document.createElement('div');
        s.className='slot';
        s.dataset.time = slot.iso;
        s.addEventListener('dragover', e=>{e.preventDefault(); s.classList.add('highlight'); e.dataTransfer.dropEffect='copy';});
        s.addEventListener('dragleave', e=>{s.classList.remove('highlight');});
        s.addEventListener('drop', e=>{s.classList.remove('highlight');onDrop(e,slot)});
        right.appendChild(s);
      });
      gridRoot.appendChild(left); gridRoot.appendChild(right);
      renderPlaced();
    }

    function renderPlaced(){
      // clear slot children then re-insert placed tasks
      qa('.slot').forEach(s=>s.innerHTML='');
      placed.forEach(p=>{
        // compute how many slots it spans
        const start = p.startIso;
        const end = p.endIso;
        const slots = qa('.slot').filter(s=>{
          const t = s.dataset.time;
          return t>=start && t<end;
        });
        if(slots.length===0) return; // off-grid
        const first = slots[0];
        const el = document.createElement('div');
        el.className='placed';
        el.dataset.placedId = p.id;
        const col = colorMap[p.color]||colorMap.blue;
        el.style.background = col[0];
        el.style.borderColor = col[1];
        el.style.top = '3px';
        el.style.bottom = '3px';
        el.style.height = `calc(${slots.length} * var(--slot-height) - 12px)`;
        el.innerHTML = `<strong>${escapeHtml(p.name)}</strong><div class="meta">${formatTimeLabel(p.startIso)} — ${formatTimeLabel(p.endIso)} • ${p.duration} min</div>`;

        el.draggable = true;
        el.addEventListener('dragstart', e=>{ e.dataTransfer.setData('text/plain', JSON.stringify({type:'placed',placedId:p.id})); e.dataTransfer.effectAllowed='move'; });
        el.addEventListener('dblclick', ()=>{ editPlaced(p.id); });
        el.addEventListener('contextmenu', e=>{ e.preventDefault(); if(confirm('Remove this placed task?')){ placed = placed.filter(x=>x.id!==p.id); saveState(); renderPlaced(); } });
        first.appendChild(el);
      });
    }

    function onDrop(e,slot){
      const data = e.dataTransfer.getData('text/plain');
      if(!data) return;
      let parsed;
      try{ parsed = JSON.parse(data);}catch(err){return}
      if(parsed.type==='bank'){
        const taskId = parsed.taskId;
        const task = tasks.find(t=>t.id===taskId); if(!task) return;
        // place task starting at slot.iso
        placeTask(task, slot.iso);
      }else if(parsed.type==='placed'){
        const pid = parsed.placedId;
        // move placed item to new start time
        const p = placed.find(x=>x.id===pid); if(!p) return;
        const dur = p.duration;
        const newStart = slot.iso;
        const newEnd = addMinutesISO(newStart,dur);
        p.startIso = newStart; p.endIso = newEnd;
        saveState(); renderPlaced();
      }
    }

    function placeTask(task, startIso){
      const dur = task.duration;
      const endIso = addMinutesISO(startIso,dur);
      // check overlap -> simple policy: allow overlap but warn
      const overlapping = placed.filter(p=> !(p.endIso<=startIso || p.startIso>=endIso));
      if(overlapping.length){ if(!confirm('This placement overlaps with existing tasks. Continue?')) return; }
      const p = {id:'p_'+Date.now(),name:task.name,duration:dur,color:task.color||'blue',notes:task.notes||'',startIso,endIso};
      placed.push(p); saveState(); renderPlaced();
    }

    function editPlaced(id){
      const p = placed.find(x=>x.id===id); if(!p) return;
      const newName = prompt('Edit task name', p.name); if(newName===null) return; p.name = newName.trim()||p.name;
      const newDur = prompt('Edit duration in minutes', String(p.duration)); if(newDur===null) return; const d = parseInt(newDur,10); if(isFinite(d)&&d>0){ p.duration = d; p.endIso = addMinutesISO(p.startIso,d);} 
      saveState(); renderPlaced();
    }

    // Persistence
    function saveState(){
      const state = {tasks,placed,startTime:startTimeInput.value,endTime:endTimeInput.value};
      localStorage.setItem('timetable_v1', JSON.stringify(state));
    }
    function loadState(showAlert=false){
      const raw = localStorage.getItem('timetable_v1');
      if(!raw) return;
      try{ const s = JSON.parse(raw); tasks = s.tasks||[]; placed = s.placed||[]; if(s.startTime) startTimeInput.value = s.startTime; if(s.endTime) endTimeInput.value = s.endTime; }catch(e){console.error(e)}
      if(showAlert) alert('Loaded saved timetable');
    }

    function onExport(){
      const data = {tasks,placed,startTime:startTimeInput.value,endTime:endTimeInput.value,exportedAt:new Date().toISOString()};
      const blob = new Blob([JSON.stringify(data, null, 2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'timetable-export.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    function onImportFile(e){
      const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = ()=>{ try{ const data = JSON.parse(r.result); if(confirm('Replace current schedule with imported data?')){ tasks = data.tasks||[]; placed = data.placed||[]; if(data.startTime) startTimeInput.value = data.startTime; if(data.endTime) endTimeInput.value = data.endTime; saveState(); renderGrid(); renderTaskBank(); renderPlaced(); alert('Imported'); } }catch(err){alert('Invalid JSON file') } }; r.readAsText(f); importFile.value=''; }

    // Time helpers - representing times as HH:MM strings (24h) maybe crossing midnight
    function parseTime(s){ // 'HH:MM'
      const [hh,mm] = (s||'00:00').split(':').map(x=>parseInt(x,10)); return {hh,mm};
    }
    function toIso(t){ const hh = String(t.hh).padStart(2,'0'); const mm = String(t.mm).padStart(2,'0'); return `${hh}:${mm}`; }
    function addMinutesISO(iso,mins){ // iso is 'HH:MM'
      let [hh,mm] = iso.split(':').map(x=>parseInt(x,10)); let total = hh*60+mm+mins; total = ((total%1440)+1440)%1440; const H = String(Math.floor(total/60)).padStart(2,'0'); const M = String(total%60).padStart(2,'0'); return `${H}:${M}`;
    }
    function buildTimeline(startObj,endObj){
      // startObj = {hh,mm}, endObj same; iterate every SLOT_MIN minutes until reaching end
      const startMin = startObj.hh*60+startObj.mm;
      const endMin = endObj.hh*60+endObj.mm;
      let timeline = [];
      let cur = startMin;
      // if end <= start treat as next day
      const target = endMin<=startMin ? endMin+1440 : endMin;
      while(cur<target){
        const h = Math.floor((cur%1440)/60); const m = cur%60;
        const iso = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
        timeline.push({iso,label:formatTimeLabel(iso)});
        cur += SLOT_MIN;
      }
      return timeline;
    }
    function formatTimeLabel(iso){ const [hh,mm]=iso.split(':').map(x=>parseInt(x,10)); const am = hh<12; const H = hh%12===0?12:hh%12; return `${H}:${String(mm).padStart(2,'0')} ${am?'AM':'PM'}`; }

    // small helpers
    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // initial load
    init();

  </script>
</body>
</html>
